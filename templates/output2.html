<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>CM3104 Prototype</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  </head>

  <body>
    <header>
      <a href="{{ url_for('index') }}"><h1>CM3104 Digital Signature Prototype</h1></a>
      <hr>
    </header>

    <table>
      <tr>
        <th>Digital Signature Download</th>
        <th>&emsp;</th>
        <th>Public Key Download</th>
        </tr>
        <tr style="display:none;">
          <td id="sig">{{ signature }}</td>
          <td>&emsp;</td>
          <td id="key">{{ key }}</td>
        </tr>
        <!-- <tr>
          <td>
            <a href="{{ url_for('static', filename='files/signature.txt') }}" download="signature.txt">
              <button>Download the Digital Signature</button>
            </a>
          </td>
          <td>&emsp;</td>
          <td>
            <a href="{{ url_for('static', filename='files/key.der') }}" download="key.der">
              <button>Download the Public Key</button>
            </a>
          </td>
        </tr> -->
        <tr>
            <td>
                <button onclick="createFile(document.getElementById('sig').value, 'signature.txt')">Download the Digital Signature</button>
            </td>
            <td></td>
            <td>
                <button onclick="createFile(document.getElementById('key').value, 'key.der')">Download the Public Key</button>
            </td>
        </tr>
    </table>

  </body>

  <script>

    function createFile(value, filename){
        console.log(filename)
        console.log(value)

        //value = value.replace()
        //create a file and put the content, name and type
        var file = new File([value], filename, {type: 'text/plain'});

        //create a ObjectURL in order to download the created file
        url = window.URL.createObjectURL(file);

        //create a hidden link and set the href and click it
        var a = document.createElement("a");
        a.style = "display: none";
        a.href = url;
        a.download = file.name;
        a.click();
        window.URL.revokeObjectURL(url);
    } 

  </script>

</html>